<div class="service-container">
    <app-backgroundpattern></app-backgroundpattern>
    <form class="form-container" #shipmentForm="ngForm" [@fadeIn]>     
      <div class="form-content">
        <mat-form-field class="form-field">
          <mat-label>Client</mat-label>
          <input matInput type="text" name="client" [(ngModel)]="model.Name" (ngModelChange)="validateField('clientName')" required>
          <div class="error-message" *ngIf="!validationStatus.clientName">
            Please Enter Client Name
          </div>
        </mat-form-field>
        <mat-form-field class="form-field">
          <mat-label>Shipment No</mat-label>
          <input matInput type="text" name="shipmentNo" [(ngModel)]="model.ShptNmbr" (ngModelChange)="validateField('shipmentNo')" required>
          <div class="error-message" *ngIf="!validationStatus.shipmentNo">
            Please Enter Shipment Number
          </div>
        </mat-form-field>
        <mat-form-field class="form-field">
            <mat-label>PO</mat-label>
            <input matInput type="text" name="Po" [(ngModel)]="model.PO" (ngModelChange)="validateField('Po')" required>
            <div class="error-message" *ngIf="!validationStatus.shipmentNo">
              Please Enter PO
            </div>
          </mat-form-field>
        <mat-form-field class="form-field">
            <mat-label>Truck No</mat-label>
            <input matInput type="text" name="TrkNo" [(ngModel)]="model.TrukNmbr" (ngModelChange)="validateField('TrkNo')" required>
            <div class="error-message" *ngIf="!validationStatus.shipmentNo">
              Please Enter Truck Number
            </div>
          </mat-form-field>
          <mat-form-field class="form-field">
            <mat-label>Supplier</mat-label>
            <input matInput type="text" name="Supp" [(ngModel)]="model.Supp" (ngModelChange)="validateField('Supp')" required>
            <div class="error-message" *ngIf="!validationStatus.shipmentNo">
              Please Enter Supplier
            </div>
          </mat-form-field>
   
        <mat-form-field class="form-field">
            <mat-label>Select Recipients</mat-label>
            <mat-select name="recipients" [(ngModel)]="model.Rpnt" (ngModelChange)="validateField('email')" required>
              <mat-option value="Accounting@priorityworldwide.com">Accounting@priorityworldwide.com</mat-option>
              <mat-option value="Operations@priorityworldwide.com">Operations@priorityworldwide.com</mat-option>
              <mat-option value="Exports@priorityworldwide.com">Exports@priorityworldwide.com</mat-option>
              <mat-option value="Imports@priorityworldwide.com">Imports@priorityworldwide.com</mat-option>
              <mat-option value="HR@priorityworldwide.com">HR@priorityworldwide.com</mat-option>
            </mat-select>
            <div class="error-message" *ngIf="!validationStatus.email">
              Please Select Recipients
            </div>
          </mat-form-field>
        <mat-form-field class="form-field">
            <input type="text" matInput placeholder="Enter Custom recipients" name="additionalRecipients" [(ngModel)]="model.CstmRpnt">
          </mat-form-field>
          <!-- (focusout)="generateReceiptNumbers(model.Qnty)"    (ngModelChange)="generatePieces()" -->
          <mat-form-field class="form-field">
            <mat-label>No. of Pieces</mat-label>
            <input matInput type="number" name="totalPieces" [(ngModel)]="totalPieces"   required>
            <button mat-icon-button (click)="generatePieces()" (focusout)="generateReceiptNumbers(totalPieces)"><mat-icon>add_circle</mat-icon></button>
            <div class="error-message" *ngIf="!validationStatus.pieces">
              Please Enter Number of Pieces
            </div>
          </mat-form-field>
   
        <div class="radio-buttons-container">
            <div class="form-field">
                <label for="selectDim"><strong>Dimension:</strong></label>
                <mat-radio-group aria-label="Select an option" name="selectDim" [(ngModel)]="dimensionSelectedOption">
                  <mat-radio-button value="cm" (change)="dimensionOptionSelected('cm')">cm</mat-radio-button>
                  <mat-radio-button value="in" (change)="dimensionOptionSelected('in')">in</mat-radio-button>
                </mat-radio-group>
              </div>
         
              <div class="form-field">
                <label for="selectDim"><strong>Weight:</strong></label>
                <mat-radio-group aria-label="Select an option" name="selectWeight" [(ngModel)]="weightSelectedOption">
                  <mat-radio-button value="kg" (change)="weightOptionSelected('kg')">kg</mat-radio-button>
                  <mat-radio-button value="lb" (change)="weightOptionSelected('lb')">lb</mat-radio-button>
                </mat-radio-group>
              </div>
        </div>    
        <div class="group-box" *ngFor="let piece of pieces; let i = index">
            <p><strong>Piece No {{i+1}}</strong></p>
          <div class="form-field">
            <mat-form-field>
              <mat-label>Length</mat-label>
              <input matInput type="text" id="lenght{{i}}" name="lenght{{i}}" [(ngModel)]="piece.length" (ngModelChange)="validateField('dimensions')" [disabled]="disableDimensionField" required>
            </mat-form-field>
          </div>
          <div class="form-field">
            <mat-form-field>
              <mat-label>Width</mat-label>
              <input matInput type="text" id="width{{i}}" name="width{{i}}" [(ngModel)]="piece.width" (ngModelChange)="validateField('dimensions')" [disabled]="disableDimensionField" required>
            </mat-form-field>
          </div>
          <div class="form-field">
            <mat-form-field>
              <mat-label>Height</mat-label>
              <input matInput type="text" id="height{{i}}" name="height{{i}}"  [(ngModel)]="piece.height" (ngModelChange)="validateField('dimensions')" [disabled]="disableDimensionField" required>
            </mat-form-field>
          </div>
          <div class="form-field">
            <mat-form-field>
              <mat-label>Weight(lb/kg)</mat-label>
              <input matInput type="text" id="weight{{i}}" name="weight{{i}}" [(ngModel)]="piece.weight" (ngModelChange)="validateField('weight')" [disabled]="disableWeightField" required>
            </mat-form-field>
          </div>
          <div class="form-field">
            <mat-form-field>
              <mat-label>Select Image</mat-label>
              <input type="file" #fileInput (change)="onFileChange($event)" name="Imgs{{i}}" accept="image/*" style="display: none;" multiple>
              <button mat-icon-button (click)="fileInput.click()">
                <mat-icon>attach_file</mat-icon>
              </button>
              <input matInput [value]="form.get('file')?.value ? form.get('file')?.value.name : ''" readonly>
              <div class="error-message" *ngIf="model.Qnty && model.Qnty > 0 && uploadedImages.length < model.Qnty">
                <div *ngIf="model.Qnty - imagesArray.length !=0 && model.Qnty-imagesArray.length >0 && pTypeSelected=='Identical' ">Please add image for Piece No.{{imageCounter}}</div>
              </div>
              <div class="progress">
                <mat-progress-bar class="progress-bar" mode="determinate" [value]="uploadProgress" *ngIf="uploadProgress"></mat-progress-bar>
                <mat-icon class="cancel-upload" (click)="cancelUpload()" *ngIf="uploadProgress">delete_forever</mat-icon>
              </div>
            </mat-form-field>
          </div>

          <div class="form-field">
            <mat-form-field>
              <mat-label>Location</mat-label>
              <input matInput type="text" id="Loc{{i}}" name="Loc{{i}}" [(ngModel)]="piece.Loc" (ngModelChange)="validateField('Loc')" [disabled]="disableDimensionField" >
            </mat-form-field>
          </div>
          <div class="form-field">
            <mat-form-field>
              <mat-label>Goods Description</mat-label>
              <input matInput type="text" id="GdDesc{{i}}" name="GdDesc{{i}}" [(ngModel)]="piece.GdDesc" (ngModelChange)="validateField('GdDesc')" [disabled]="disableDimensionField" >
            </mat-form-field>
          </div>
        </div> 
      </div>
      <div class="save-button-container">
        <button mat-raised-button color="primary" type="submit" (click)="onSubmit()">Save<mat-icon>save</mat-icon></button>
      </div>
    </form>
  </div>   
  <div class="text-container">
    <h2>Receivings New</h2>
  </div>